#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <linux/fs.h>
#include <string.h>
#include <unistd.h>

#define BUFFER_SIZE 1024

int main()
{
  char userinput;
  //line below: set the last character as the end of the buffer to signify end of buffer space
  static char buffer[BUFFER_SIZE] = {'\0'};
  //prompt user input (no input quite yet)
  printf("press 'r' to read, 's' to seek, or 'w' to write. If you want to exit,"
	 "press 'e'.\n");
  //open file and return file descriptor as an integer, if returns -1 throw error.
  int fileStruct = open("/dev/simple_character_device", O_RDWR);
  while(1)
  {
    printf("enter command\n");
    scanf("%c", &userinput);
    switch (userinput)
      {
      case 'r':
	{
	  int readbytes;
	  printf("enter number of bytes to read. \n");
	  scanf("%d", &readbytes);
	  read(fileStruct, buffer, readbytes);
	  printf("data read from device: %s\n", buffer);
	  //free the array
	  memset(buffer, 0, sizeof(buffer));
	  //we dont want to include pressing "enter" as a character.
	  while (getchar() != '\n');
	  break;
	}
      case 'w':
	{
	  int byteswrite;
	  printf("enter the data you want to write in. ");
	  scanf("%s", buffer);
	  byteswrite = strlen(buffer);
	  write(fileStruct, buffer, byteswrite);
	  printf("data from buffer %s\n", buffer);
	  printf("number of bytes written %d\n", byteswrite);
	  memset(buffer, 0, BUFFER_SIZE);
	  while(getchar() != '\n');
	  break;
	}
      case 's':
	{
	  int offset_int = 0;
	  printf("enter offset value %d\n");
	  scanf("%d", &offset_int);
	  int whence = 0;
	  printf("enter whence value %d\n");
	  scanf("%d", &whence);
	  llseek(fileStruct, offset_int, whence);
	  while(getchar() != '\n');
	  break;
	}
      case 'e':
	return 0;
	break;
      default:
	break;
      }
    
  } 

  return 0;
}
